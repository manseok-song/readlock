events {
    worker_connections 1024;
}

http {
    upstream auth_service { server auth-service:8000; }
    upstream book_service { server book-service:8000; }
    upstream reading_service { server reading-service:8000; }
    upstream community_service { server community-service:8000; }
    upstream user_service { server user-service:8000; }
    upstream map_service { server map-service:8000; }
    upstream ai_service { server ai-service:8000; }
    upstream notification_service { server notification-service:8000; }
    upstream gamification_service { server gamification-service:8000; }
    upstream subscription_service { server subscription-service:8000; }

    server {
        listen 80;
        server_name localhost;

        location /health {
            return 200 '{"status":"healthy","service":"api-gateway"}';
            default_type application/json;
        }

        location /v1/auth {
            proxy_pass http://auth_service/v1/auth;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        location /v1/me {
            proxy_pass http://user_service/v1/me;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header Authorization $http_authorization;
        }

        location /v1/users {
            proxy_pass http://user_service/v1/users;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header Authorization $http_authorization;
        }

        location /v1/books {
            proxy_pass http://book_service/v1/books;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header Authorization $http_authorization;
        }

        location /v1/library {
            proxy_pass http://book_service/v1/library;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header Authorization $http_authorization;
        }

        location /v1/reading {
            proxy_pass http://reading_service/v1/reading;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header Authorization $http_authorization;
        }

        location /v1/sessions {
            proxy_pass http://reading_service/v1/sessions;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header Authorization $http_authorization;
        }

        location /v1/feed {
            proxy_pass http://community_service/v1/feed;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header Authorization $http_authorization;
        }

        location /v1/quotes {
            proxy_pass http://community_service/v1/quotes;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header Authorization $http_authorization;
        }

        location /v1/reviews {
            proxy_pass http://community_service/v1/reviews;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header Authorization $http_authorization;
        }

        location /v1/bookstores {
            proxy_pass http://map_service/v1/bookstores;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header Authorization $http_authorization;
        }

        location /v1/checkins {
            proxy_pass http://map_service/v1/checkins;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header Authorization $http_authorization;
        }

        location /v1/recommendations {
            proxy_pass http://ai_service/v1/recommendations;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header Authorization $http_authorization;
        }

        location /v1/notifications {
            proxy_pass http://notification_service/v1/notifications;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header Authorization $http_authorization;
        }

        location /v1/gamification {
            proxy_pass http://gamification_service/v1/gamification;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header Authorization $http_authorization;
        }

        location /v1/badges {
            proxy_pass http://gamification_service/v1/badges;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header Authorization $http_authorization;
        }

        location /v1/shop {
            proxy_pass http://gamification_service/v1/shop;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header Authorization $http_authorization;
        }

        location /v1/leaderboard {
            proxy_pass http://gamification_service/v1/leaderboard;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header Authorization $http_authorization;
        }

        location /v1/avatar {
            proxy_pass http://gamification_service/v1/avatar;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header Authorization $http_authorization;
        }

        location /v1/room {
            proxy_pass http://gamification_service/v1/room;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header Authorization $http_authorization;
        }

        location /v1/subscriptions {
            proxy_pass http://subscription_service/v1/subscriptions;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header Authorization $http_authorization;
        }

        location /v1/payments {
            proxy_pass http://subscription_service/v1/payments;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header Authorization $http_authorization;
        }

        location /v1/coins {
            proxy_pass http://subscription_service/v1/coins;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header Authorization $http_authorization;
        }
    }
}
