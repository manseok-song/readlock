{
  "name": "ReadLock 2.0 Full Test & Fix Loop",
  "version": "1.0.0",
  "description": "모든 백엔드 서비스 기능 테스트 및 버그 수정을 위한 Ralph Loop 설정",
  "config": {
    "max_iterations": 10,
    "stop_on_success": true,
    "parallel_execution": false,
    "verbose": true
  },
  "environment": {
    "BASE_URL": "http://localhost",
    "AUTH_PORT": 8000,
    "BOOK_PORT": 8001,
    "READING_PORT": 8002,
    "COMMUNITY_PORT": 8003,
    "USER_PORT": 8004,
    "MAP_PORT": 8005,
    "AI_PORT": 8006,
    "NOTIFICATION_PORT": 8007,
    "GAMIFICATION_PORT": 8008,
    "SUBSCRIPTION_PORT": 8009,
    "DB_CONTAINER": "readlock-postgres",
    "COMPOSE_FILE": "backend/docker-compose.yml"
  },
  "phases": [
    {
      "id": "phase-0-health",
      "name": "서비스 헬스체크",
      "description": "모든 서비스가 정상 실행 중인지 확인",
      "tasks": [
        {
          "id": "health-check-all",
          "name": "전체 서비스 헬스체크",
          "type": "bash",
          "command": "for port in 8000 8001 8002 8003 8004 8005 8006 8007 8008 8009; do echo -n \"Port $port: \"; curl -sf http://localhost:$port/health || echo 'FAILED'; done",
          "success_criteria": "모든 포트에서 healthy 응답",
          "on_failure": {
            "action": "restart_services",
            "command": "docker-compose -f backend/docker-compose.yml restart"
          }
        },
        {
          "id": "db-connection",
          "name": "데이터베이스 연결 확인",
          "type": "bash",
          "command": "docker-compose -f backend/docker-compose.yml exec -T postgres psql -U readlock -d readlock -c 'SELECT 1'",
          "success_criteria": "쿼리 성공"
        },
        {
          "id": "redis-connection",
          "name": "Redis 연결 확인",
          "type": "bash",
          "command": "docker-compose -f backend/docker-compose.yml exec -T redis redis-cli ping",
          "success_criteria": "PONG 응답"
        }
      ]
    },
    {
      "id": "phase-1-auth",
      "name": "Auth Service 테스트",
      "description": "인증 서비스 전체 기능 테스트",
      "depends_on": ["phase-0-health"],
      "tasks": [
        {
          "id": "auth-register",
          "name": "회원가입 테스트",
          "type": "api",
          "method": "POST",
          "url": "http://localhost:8000/v1/auth/register",
          "body": {
            "email": "test@readlock.com",
            "password": "TestPassword123!",
            "nickname": "테스트유저"
          },
          "expected_status": [201, 409],
          "save_response": true,
          "on_failure": {
            "action": "investigate",
            "files": [
              "backend/services/auth/app/services/auth_service.py",
              "backend/services/auth/app/api/auth_routes.py"
            ]
          }
        },
        {
          "id": "auth-login",
          "name": "로그인 테스트",
          "type": "api",
          "method": "POST",
          "url": "http://localhost:8000/v1/auth/login",
          "body": {
            "email": "test@readlock.com",
            "password": "TestPassword123!"
          },
          "expected_status": 200,
          "save_response": {
            "access_token": "$.accessToken",
            "refresh_token": "$.refreshToken"
          }
        },
        {
          "id": "auth-me",
          "name": "현재 사용자 정보 조회",
          "type": "api",
          "method": "GET",
          "url": "http://localhost:8000/v1/auth/me",
          "headers": {
            "Authorization": "Bearer {{access_token}}"
          },
          "expected_status": 200
        },
        {
          "id": "auth-refresh",
          "name": "토큰 갱신 테스트",
          "type": "api",
          "method": "POST",
          "url": "http://localhost:8000/v1/auth/refresh",
          "body": {
            "refreshToken": "{{refresh_token}}"
          },
          "expected_status": 200
        }
      ]
    },
    {
      "id": "phase-2-user",
      "name": "User Service 테스트",
      "description": "사용자 프로필 관리 기능 테스트",
      "depends_on": ["phase-1-auth"],
      "tasks": [
        {
          "id": "user-profile-get",
          "name": "프로필 조회",
          "type": "api",
          "method": "GET",
          "url": "http://localhost:8004/api/v1/users/profile",
          "headers": {
            "Authorization": "Bearer {{access_token}}"
          },
          "expected_status": [200, 404]
        },
        {
          "id": "user-profile-update",
          "name": "프로필 수정",
          "type": "api",
          "method": "PUT",
          "url": "http://localhost:8004/api/v1/users/profile",
          "headers": {
            "Authorization": "Bearer {{access_token}}"
          },
          "body": {
            "bio": "독서를 사랑하는 개발자입니다.",
            "reading_goal": 30
          },
          "expected_status": [200, 201]
        }
      ]
    },
    {
      "id": "phase-3-book",
      "name": "Book Service 테스트",
      "description": "책 검색 및 서재 관리 기능 테스트",
      "depends_on": ["phase-1-auth"],
      "tasks": [
        {
          "id": "book-search",
          "name": "책 검색 테스트",
          "type": "api",
          "method": "GET",
          "url": "http://localhost:8001/api/v1/books/search?query=해리포터",
          "headers": {
            "Authorization": "Bearer {{access_token}}"
          },
          "expected_status": 200,
          "note": "네이버 API 키가 필요할 수 있음"
        },
        {
          "id": "book-library-list",
          "name": "서재 목록 조회",
          "type": "api",
          "method": "GET",
          "url": "http://localhost:8001/api/v1/books/library",
          "headers": {
            "Authorization": "Bearer {{access_token}}"
          },
          "expected_status": 200
        }
      ]
    },
    {
      "id": "phase-4-reading",
      "name": "Reading Service 테스트",
      "description": "독서 세션 및 통계 기능 테스트",
      "depends_on": ["phase-1-auth"],
      "tasks": [
        {
          "id": "reading-stats",
          "name": "독서 통계 조회",
          "type": "api",
          "method": "GET",
          "url": "http://localhost:8002/api/v1/reading/stats",
          "headers": {
            "Authorization": "Bearer {{access_token}}"
          },
          "expected_status": 200
        },
        {
          "id": "reading-streak",
          "name": "독서 스트릭 조회",
          "type": "api",
          "method": "GET",
          "url": "http://localhost:8002/api/v1/reading/streak",
          "headers": {
            "Authorization": "Bearer {{access_token}}"
          },
          "expected_status": 200
        },
        {
          "id": "reading-goals",
          "name": "독서 목표 조회",
          "type": "api",
          "method": "GET",
          "url": "http://localhost:8002/api/v1/reading/goals",
          "headers": {
            "Authorization": "Bearer {{access_token}}"
          },
          "expected_status": 200
        }
      ]
    },
    {
      "id": "phase-5-community",
      "name": "Community Service 테스트",
      "description": "커뮤니티 기능 (인용구, 리뷰, 피드) 테스트",
      "depends_on": ["phase-1-auth"],
      "tasks": [
        {
          "id": "community-feed",
          "name": "피드 조회",
          "type": "api",
          "method": "GET",
          "url": "http://localhost:8003/api/v1/community/feed",
          "headers": {
            "Authorization": "Bearer {{access_token}}"
          },
          "expected_status": 200
        },
        {
          "id": "community-quotes",
          "name": "인용구 목록 조회",
          "type": "api",
          "method": "GET",
          "url": "http://localhost:8003/api/v1/community/quotes",
          "headers": {
            "Authorization": "Bearer {{access_token}}"
          },
          "expected_status": 200
        }
      ]
    },
    {
      "id": "phase-6-map",
      "name": "Map Service 테스트",
      "description": "서점 지도 및 체크인 기능 테스트",
      "depends_on": ["phase-1-auth"],
      "tasks": [
        {
          "id": "map-nearby",
          "name": "주변 서점 검색",
          "type": "api",
          "method": "GET",
          "url": "http://localhost:8005/api/v1/map/bookstores/nearby?latitude=37.5665&longitude=126.9780&radius=5000",
          "headers": {
            "Authorization": "Bearer {{access_token}}"
          },
          "expected_status": 200
        },
        {
          "id": "map-favorites",
          "name": "즐겨찾기 서점 조회",
          "type": "api",
          "method": "GET",
          "url": "http://localhost:8005/api/v1/map/bookstores/favorites",
          "headers": {
            "Authorization": "Bearer {{access_token}}"
          },
          "expected_status": 200
        }
      ]
    },
    {
      "id": "phase-7-ai",
      "name": "AI Service 테스트",
      "description": "AI 추천 및 인사이트 기능 테스트",
      "depends_on": ["phase-1-auth"],
      "tasks": [
        {
          "id": "ai-recommendations",
          "name": "맞춤 추천 조회",
          "type": "api",
          "method": "GET",
          "url": "http://localhost:8006/api/v1/recommendations/personalized",
          "headers": {
            "Authorization": "Bearer {{access_token}}"
          },
          "expected_status": 200
        },
        {
          "id": "ai-trending",
          "name": "트렌딩 도서 조회",
          "type": "api",
          "method": "GET",
          "url": "http://localhost:8006/api/v1/recommendations/trending",
          "headers": {
            "Authorization": "Bearer {{access_token}}"
          },
          "expected_status": 200
        }
      ]
    },
    {
      "id": "phase-8-notification",
      "name": "Notification Service 테스트",
      "description": "알림 기능 테스트",
      "depends_on": ["phase-1-auth"],
      "tasks": [
        {
          "id": "notification-list",
          "name": "알림 목록 조회",
          "type": "api",
          "method": "GET",
          "url": "http://localhost:8007/api/v1/notifications",
          "headers": {
            "Authorization": "Bearer {{access_token}}"
          },
          "expected_status": 200
        },
        {
          "id": "notification-settings",
          "name": "알림 설정 조회",
          "type": "api",
          "method": "GET",
          "url": "http://localhost:8007/api/v1/notifications/settings",
          "headers": {
            "Authorization": "Bearer {{access_token}}"
          },
          "expected_status": 200
        }
      ]
    },
    {
      "id": "phase-9-gamification",
      "name": "Gamification Service 테스트",
      "description": "게이미피케이션 (뱃지, 레벨, 상점) 기능 테스트",
      "depends_on": ["phase-1-auth"],
      "tasks": [
        {
          "id": "gamification-badges",
          "name": "전체 뱃지 조회",
          "type": "api",
          "method": "GET",
          "url": "http://localhost:8008/api/v1/badges/",
          "headers": {
            "Authorization": "Bearer {{access_token}}"
          },
          "expected_status": 200
        },
        {
          "id": "gamification-my-badges",
          "name": "내 뱃지 조회",
          "type": "api",
          "method": "GET",
          "url": "http://localhost:8008/api/v1/badges/me",
          "headers": {
            "Authorization": "Bearer {{access_token}}"
          },
          "expected_status": 200
        },
        {
          "id": "gamification-level",
          "name": "내 레벨 조회",
          "type": "api",
          "method": "GET",
          "url": "http://localhost:8008/api/v1/levels/me",
          "headers": {
            "Authorization": "Bearer {{access_token}}"
          },
          "expected_status": 200
        },
        {
          "id": "gamification-shop",
          "name": "상점 아이템 조회",
          "type": "api",
          "method": "GET",
          "url": "http://localhost:8008/api/v1/shop/items",
          "headers": {
            "Authorization": "Bearer {{access_token}}"
          },
          "expected_status": 200
        },
        {
          "id": "gamification-coins",
          "name": "코인 잔액 조회",
          "type": "api",
          "method": "GET",
          "url": "http://localhost:8008/api/v1/shop/coins",
          "headers": {
            "Authorization": "Bearer {{access_token}}"
          },
          "expected_status": 200
        },
        {
          "id": "gamification-leaderboard",
          "name": "리더보드 조회",
          "type": "api",
          "method": "GET",
          "url": "http://localhost:8008/api/v1/leaderboard/reading-time",
          "headers": {
            "Authorization": "Bearer {{access_token}}"
          },
          "expected_status": 200
        }
      ]
    },
    {
      "id": "phase-10-subscription",
      "name": "Subscription Service 테스트",
      "description": "구독 및 결제 기능 테스트",
      "depends_on": ["phase-1-auth"],
      "tasks": [
        {
          "id": "subscription-plans",
          "name": "구독 플랜 조회",
          "type": "api",
          "method": "GET",
          "url": "http://localhost:8009/api/v1/subscriptions/plans",
          "headers": {
            "Authorization": "Bearer {{access_token}}"
          },
          "expected_status": 200
        },
        {
          "id": "subscription-my",
          "name": "내 구독 정보 조회",
          "type": "api",
          "method": "GET",
          "url": "http://localhost:8009/api/v1/subscriptions/me",
          "headers": {
            "Authorization": "Bearer {{access_token}}"
          },
          "expected_status": [200, 404]
        },
        {
          "id": "payment-methods",
          "name": "결제 수단 조회",
          "type": "api",
          "method": "GET",
          "url": "http://localhost:8009/api/v1/payments/methods",
          "headers": {
            "Authorization": "Bearer {{access_token}}"
          },
          "expected_status": 200
        },
        {
          "id": "coin-packages",
          "name": "코인 패키지 조회",
          "type": "api",
          "method": "GET",
          "url": "http://localhost:8009/api/v1/payments/coins/packages",
          "headers": {
            "Authorization": "Bearer {{access_token}}"
          },
          "expected_status": 200
        }
      ]
    }
  ],
  "fix_strategies": {
    "import_error": {
      "description": "임포트 오류 발생 시",
      "steps": [
        "오류 메시지에서 누락된 모듈 확인",
        "해당 파일에서 import 문 수정",
        "docker-compose build --no-cache {service}",
        "docker-compose up -d {service}"
      ]
    },
    "database_error": {
      "description": "데이터베이스 관련 오류 발생 시",
      "steps": [
        "alembic history로 마이그레이션 상태 확인",
        "테이블 존재 여부 확인",
        "필요시 alembic upgrade head 실행",
        "모델과 마이그레이션 스키마 일치 여부 확인"
      ]
    },
    "auth_error": {
      "description": "인증 오류 발생 시 (401/403)",
      "steps": [
        "JWT 토큰 유효성 확인",
        "shared/middleware/auth.py 확인",
        "토큰 만료 시간 확인",
        "Authorization 헤더 형식 확인"
      ]
    },
    "validation_error": {
      "description": "요청 유효성 검증 오류 (422)",
      "steps": [
        "스키마 정의 확인 (schemas/*.py)",
        "필수 필드 확인",
        "데이터 타입 일치 여부 확인"
      ]
    },
    "not_found_error": {
      "description": "리소스 없음 오류 (404)",
      "steps": [
        "라우트 정의 확인",
        "URL 경로 및 prefix 확인",
        "main.py에서 라우터 등록 확인"
      ]
    }
  },
  "reports": {
    "output_dir": "test-reports",
    "formats": ["json", "html"],
    "include": {
      "timestamp": true,
      "duration": true,
      "request_details": true,
      "response_details": true,
      "error_traces": true
    }
  }
}
